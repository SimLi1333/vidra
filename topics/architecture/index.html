<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-topics/architecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">Architecture | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://infrahub-operator.github.io/vidra/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://infrahub-operator.github.io/vidra/img/social-card.png"><meta data-rh="true" property="og:url" content="https://infrahub-operator.github.io/vidra/topics/architecture"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture | My Site"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/vidra/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://infrahub-operator.github.io/vidra/topics/architecture"><link data-rh="true" rel="alternate" href="https://infrahub-operator.github.io/vidra/topics/architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://infrahub-operator.github.io/vidra/topics/architecture" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Architecture","item":"https://infrahub-operator.github.io/vidra/topics/architecture"}]}</script><link rel="alternate" type="application/rss+xml" href="/vidra/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/vidra/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/vidra/assets/css/styles.c171c55a.css">
<script src="/vidra/assets/js/runtime~main.ee069b6a.js" defer="defer"></script>
<script src="/vidra/assets/js/main.404b3762.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/vidra/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/vidra/"><div class="navbar__logo"><img src="/vidra/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/vidra/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Vidra</b></a><a class="navbar__item navbar__link" href="/vidra/">Documentation</a><a class="navbar__item navbar__link" href="/vidra/cli/">CLI</a><a class="navbar__item navbar__link" href="/vidra/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/infrahub-operator/vidra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vidra/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/vidra/concepts/">Concepts</a><button aria-label="Expand sidebar category &#x27;Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/vidra/guides/install">Guides</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vidra/api-references/">API References</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/vidra/topics/architecture">Topics</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/vidra/topics/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/vidra/topics/desicions/use-markdown-architectural-decision-records">Desicions</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vidra/topics/contributions">Contributor Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vidra/topics/coding-conventions">Coding Conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vidra/topics/deploy">Cluster Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vidra/topics/testing">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vidra/topics/ci">Continuos Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vidra/topics/preliminary-work">Preliminary Work</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vidra/comparison/">Comparison</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/vidra/about/">About</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/vidra/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Topics</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Architecture</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Architecture</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>Vidra is a <strong>Kubernetes operator</strong> that automates the synchronization and management of infrastructure resources via the Infrahub platform. It streamlines the process of querying, retrieving, and applying configuration artifacts to Kubernetes clusters, enabling efficient and automated infrastructure lifecycle management.</p>
<p>The architecture is modular, extensible, and resilient, following Kubernetes operator patterns and cloud-native best practices. This section describes Vidra’s core components, data flow, interactions, and design rationale.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-overview-of-vidra-architecture">1. Overview of Vidra Architecture<a href="#1-overview-of-vidra-architecture" class="hash-link" aria-label="Direct link to 1. Overview of Vidra Architecture" title="Direct link to 1. Overview of Vidra Architecture">​</a></h2>
<p>Vidra is implemented as a <strong>Kubernetes operator</strong>, extending the Kubernetes control plane to manage custom resources representing Infrahub synchronization configurations. The operator continuously reconciles desired states defined in these custom resources with actual cluster state, ensuring automated, declarative management of infrastructure artifacts.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-architectural-goals">Key Architectural Goals:<a href="#key-architectural-goals" class="hash-link" aria-label="Direct link to Key Architectural Goals:" title="Direct link to Key Architectural Goals:">​</a></h3>
<ul>
<li><strong>Declarative Resource Management:</strong> Users specify synchronization requirements via custom resources; Vidra automates downstream artifact application.</li>
<li><strong>GitOps Principles:</strong> Supports Git-based workflows, allowing users to define infrastructure as code and manage it through version control.</li>
<li><strong>Extensibility:</strong> Modular architecture enables support for additional artifact types, expanded Infrahub query capabilities, and even integration with any other system that generate manifests.</li>
<li><strong>Scalability and Robustness:</strong> Efficient handling of concurrent sync operations with robust error handling.</li>
<li><strong>Separation of Concerns:</strong> Clear boundaries between domain logic, external system integration, and Kubernetes API interactions.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-c4-model">2. C4 Model<a href="#2-c4-model" class="hash-link" aria-label="Direct link to 2. C4 Model" title="Direct link to 2. C4 Model">​</a></h2>
<p>The following diagrams illustrate the C4 model for Vidra, providing a high-level perspective on its architecture and interactions within the Kubernetes ecosystem.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="system-context-diagram-c1">System Context Diagram (C1)<a href="#system-context-diagram-c1" class="hash-link" aria-label="Direct link to System Context Diagram (C1)" title="Direct link to System Context Diagram (C1)">​</a></h3>
<p><img decoding="async" loading="lazy" alt="System Context Diagram" src="/vidra/assets/images/C1.drawio-78024259a8683ffd0f1dc5ab3866d8e5.png" width="927" height="507" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="container-diagram-c2">Container Diagram (C2)<a href="#container-diagram-c2" class="hash-link" aria-label="Direct link to Container Diagram (C2)" title="Direct link to Container Diagram (C2)">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Container Diagram" src="/vidra/assets/images/C2.drawio-df5b7198a068905d029d51af9378ace5.png" width="1367" height="940" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="component-diagram-c3">Component Diagram (C3)<a href="#component-diagram-c3" class="hash-link" aria-label="Direct link to Component Diagram (C3)" title="Direct link to Component Diagram (C3)">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Component Diagram" src="/vidra/assets/images/C3.drawio-07aafb1cc113b112ee0027661ba5c0b4.png" width="1394" height="1060" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="high-level-code-structure-c4">High-Level Code Structure (C4)<a href="#high-level-code-structure-c4" class="hash-link" aria-label="Direct link to High-Level Code Structure (C4)" title="Direct link to High-Level Code Structure (C4)">​</a></h2>
<p>Vidra is structured into three primary layers, each implemented as a distinct Go package to promote a clean, maintainable architecture:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-domain-layer">2.1 Domain Layer<a href="#21-domain-layer" class="hash-link" aria-label="Direct link to 2.1 Domain Layer" title="Direct link to 2.1 Domain Layer">​</a></h3>
<p>The <strong>Domain Layer</strong> defines Vidra’s core business entities and domain interfaces. This layer is intentionally minimal, focusing primarily on the <code>InfrahubSync</code> and <code>VidraResource</code> custom resources, which represent the essential concepts and behaviors within Vidra.</p>
<ul>
<li><strong>InfrahubSync:</strong> Captures synchronization intent, including parameters such as target branches, artifacts, and scheduling.</li>
<li><strong>VidraResource:</strong> Represents Kubernetes resources (e.g., ConfigMaps, Secrets, Deployments) managed by Vidra, typically created based on retrieved Infrahub artifacts.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-api-layer">2.2 API Layer<a href="#22-api-layer" class="hash-link" aria-label="Direct link to 2.2 API Layer" title="Direct link to 2.2 API Layer">​</a></h3>
<p>The <strong><a href="/vidra/api-references/">API Layer</a></strong> exposes Vidra’s functionality to users through well-defined custom resource definitions (CRDs) and their schemas.</p>
<ul>
<li><strong>InfrahubSync CRD:</strong> The primary entry point for configuring Vidra, allowing users to specify synchronization parameters.</li>
<li><strong>VidraResource CRD:</strong> Defines the structure for Kubernetes resources managed by Vidra, enabling declarative management of cluster artifacts.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-controller-layer">2.3 Controller Layer<a href="#23-controller-layer" class="hash-link" aria-label="Direct link to 2.3 Controller Layer" title="Direct link to 2.3 Controller Layer">​</a></h3>
<p>The <strong>Controller Layer</strong> implements the reconciliation logic that drives Vidra’s synchronization workflows. Controllers monitor changes to custom resources and orchestrate the necessary actions to align cluster state with the desired configuration.</p>
<ul>
<li><strong>InfrahubSyncReconciler:</strong> Handles all tasks related to Infrahub, including authentication, querying, artifact retrieval, and triggering downstream synchronization.</li>
<li><strong>VidraResourceReconciler:</strong> Manages the lifecycle of Kubernetes resources, applying, updating, or deleting manifests as needed.</li>
</ul>
<p>Each controller is dedicated to a specific CRD, ensuring clear separation of concerns and enabling future extensibility.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-adapter-layer">2.4 Adapter Layer<a href="#24-adapter-layer" class="hash-link" aria-label="Direct link to 2.4 Adapter Layer" title="Direct link to 2.4 Adapter Layer">​</a></h3>
<p>The <strong>Adapter Layer</strong> manages integrations with external systems, such as Infrahub and Kubernetes clusters. It handles API communication, artifact processing, and abstracts external dependencies behind interfaces, facilitating testing and future expansion.</p>
<p>This layered approach enforces separation of concerns, simplifies testing, and enables future extensibility. Dependencies between layers are managed through interfaces, allowing for easy mocking and unit testing. Importantly, dependencies only go inward—outer layers depend on inner layers, but not vice versa—ensuring a clean, maintainable architecture.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-data-flow-and-interaction">3. Data Flow and Interaction<a href="#3-data-flow-and-interaction" class="hash-link" aria-label="Direct link to 3. Data Flow and Interaction" title="Direct link to 3. Data Flow and Interaction">​</a></h2>
<ol>
<li>
<p><strong>Custom Resource Creation (CR):</strong><br>
<!-- -->Users create an <code>InfrahubSync</code> resource, specifying parameters such as the Infrahub query, target artifact, target branch, and (optionally) a target date. This resource acts as the declarative specification for what should be synchronized from Infrahub into the Kubernetes cluster.</p>
</li>
<li>
<p><strong>Event Trigger:</strong> The Kubernetes API server notifies the infrahubSync controller of the resource creation or update.</p>
</li>
<li>
<p><strong>InfrahubSync Reconciliation Loop:</strong></p>
<ul>
<li>Retrieves User and Password from the Secret with annotation <code>infrahub-api-url: &lt;infrahub-api-url&gt;</code>.</li>
<li>Authenticates to Infrahub using configured credentials.</li>
<li>Executes the specified query (in ConfigMap <code>vidra-config</code>) on Infrahub and retrieves metadata about the resulting artifact.</li>
<li>Downloads the artifacts (e.g., a Kubernetes manifest bundle).</li>
<li>Applies the artifacts and its manifests each to a <code>VidraResource</code> with the artifact ID as name.</li>
<li>Updates resource status to reflect success or failure of the sync process.</li>
</ul>
</li>
<li>
<p><strong>Event Trigger:</strong> The Kubernetes API server notifies the vidraResource controller of the resource creation or update.</p>
</li>
<li>
<p><strong>VidraResource Reconciliation Loop:</strong></p>
<ul>
<li>Monitors <code>VidraResource</code> CR&#x27;s created by the InfrahubSync controller.</li>
<li>Applies the manifests to the destination Kubernetes cluster (can be a different cluster), ensuring the desired state matches the actual state.</li>
<li>Creates lists and finalizers of the managed resources, allowing for easy tracking, management and deletion of resources or VidraResources.</li>
<li>Applies event based reconciliation, where changes to the managed resources triggers reconciliation or adds a timebased reconcile interval.</li>
<li>Updates resource status to reflect success or failure of the application process.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Vidra Data Flow" src="/vidra/assets/images/data-flow.drawio-45a19f17c5817ae432934dbf6db51f37.png" width="1394" height="1060" class="img_ev3q"></p>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-design-patterns-and-technologies">4. Design Patterns and Technologies<a href="#4-design-patterns-and-technologies" class="hash-link" aria-label="Direct link to 4. Design Patterns and Technologies" title="Direct link to 4. Design Patterns and Technologies">​</a></h2>
<ul>
<li><strong>Operator SDK &amp; Controller Runtime:</strong> Vidra leverages the Operator SDK framework, providing scaffolding for controller creation, client interactions, and CR management.</li>
<li><strong>Domain-Driven Design (DDD) / Clean Architecture:</strong> Clear separation between domain entities, business logic, and infrastructure concerns to improve maintainability.</li>
<li><strong>Interface Abstraction:</strong> External system clients (Infrahub API, Kubernetes client) are abstracted by interfaces, facilitating unit testing and mocking.</li>
<li><strong>Reconciliation Model:</strong> Follows Kubernetes’ declarative reconciliation paradigm, ensuring eventual consistency between desired and actual state.</li>
<li><strong>Factory Pattern:</strong> Used to create go-client used to connect to other Kubernetes clusters or managing EventBased scheduling, allowing for flexible configuration and easy testing.</li>
<li><strong>Exponential Backoff:</strong> Implements retry logic for transient errors during API calls (Infrahub and K8s), enhancing resilience against temporary failures.</li>
<li><strong>Finalizers:</strong> Utilized to manage resource cleanup and prevent premature deletion of resources while they are still being processed.</li>
<li><strong>Event-Driven Architecture:</strong> Controllers respond to Kubernetes events, lavraging a Kubernetes Concept called <code>Informers</code> triggering reconciliation based on resource changes, ensuring timely updates and synchronization.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-error-handling-and-resilience">5. Error Handling and Resilience<a href="#5-error-handling-and-resilience" class="hash-link" aria-label="Direct link to 5. Error Handling and Resilience" title="Direct link to 5. Error Handling and Resilience">​</a></h2>
<p>Vidra implements comprehensive error handling strategies:</p>
<ul>
<li>Transient failures during API calls trigger retries with exponential backoff.</li>
<li>Validation errors halt reconciliation with clear status messages which are statet in the resource status.</li>
<li>Unexpected errors are logged and surfaced in resource conditions, enabling operators to diagnose issues.</li>
<li>Concurrency controls prevent conflicting sync operations from corrupting cluster state.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-extensibility-and-future-directions">6. Extensibility and Future Directions<a href="#6-extensibility-and-future-directions" class="hash-link" aria-label="Direct link to 6. Extensibility and Future Directions" title="Direct link to 6. Extensibility and Future Directions">​</a></h2>
<p>The modular architecture of Vidra allows:</p>
<ul>
<li>Adoption of additional artifact types, enabling reconciliation of any Kubernetes resource—including custom resources (CRs)</li>
<li>Addition of new Infrahub query capabilities and authentication methods.</li>
<li>Enhanced observability via metrics and tracing.</li>
</ul>
<p>This design ensures Vidra can evolve to meet growing infrastructure automation demands and diverse deployment scenarios.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/vidra/api-references/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">API References</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/vidra/topics/desicions/use-markdown-architectural-decision-records"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Use Markdown Architectural Decision Records</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#1-overview-of-vidra-architecture" class="table-of-contents__link toc-highlight">1. Overview of Vidra Architecture</a><ul><li><a href="#key-architectural-goals" class="table-of-contents__link toc-highlight">Key Architectural Goals:</a></li></ul></li><li><a href="#2-c4-model" class="table-of-contents__link toc-highlight">2. C4 Model</a><ul><li><a href="#system-context-diagram-c1" class="table-of-contents__link toc-highlight">System Context Diagram (C1)</a></li><li><a href="#container-diagram-c2" class="table-of-contents__link toc-highlight">Container Diagram (C2)</a></li><li><a href="#component-diagram-c3" class="table-of-contents__link toc-highlight">Component Diagram (C3)</a></li></ul></li><li><a href="#high-level-code-structure-c4" class="table-of-contents__link toc-highlight">High-Level Code Structure (C4)</a><ul><li><a href="#21-domain-layer" class="table-of-contents__link toc-highlight">2.1 Domain Layer</a></li><li><a href="#22-api-layer" class="table-of-contents__link toc-highlight">2.2 API Layer</a></li><li><a href="#23-controller-layer" class="table-of-contents__link toc-highlight">2.3 Controller Layer</a></li><li><a href="#24-adapter-layer" class="table-of-contents__link toc-highlight">2.4 Adapter Layer</a></li></ul></li><li><a href="#3-data-flow-and-interaction" class="table-of-contents__link toc-highlight">3. Data Flow and Interaction</a></li><li><a href="#4-design-patterns-and-technologies" class="table-of-contents__link toc-highlight">4. Design Patterns and Technologies</a></li><li><a href="#5-error-handling-and-resilience" class="table-of-contents__link toc-highlight">5. Error Handling and Resilience</a></li><li><a href="#6-extensibility-and-future-directions" class="table-of-contents__link toc-highlight">6. Extensibility and Future Directions</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"></div></footer></div>
</body>
</html>