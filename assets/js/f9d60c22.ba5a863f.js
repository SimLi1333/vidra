"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8273],{7293:(e,n,t)=>{t.d(n,{A:()=>V});var i=t(6540),o=t(4848);function s(e){const{mdxAdmonitionTitle:n,rest:t}=function(e){const n=i.Children.toArray(e),t=n.find((e=>i.isValidElement(e)&&"mdxAdmonitionTitle"===e.type)),s=n.filter((e=>e!==t)),r=t?.props.children;return{mdxAdmonitionTitle:r,rest:s.length>0?(0,o.jsx)(o.Fragment,{children:s}):null}}(e.children),s=e.title??n;return{...e,...s&&{title:s},children:t}}var r=t(4164),a=t(1312),c=t(7559);const d="admonition_xJq3",l="admonitionHeading_Gvgb",h="admonitionIcon_Rf37",u="admonitionContent_BuS1";function m({type:e,className:n,children:t}){return(0,o.jsx)("div",{className:(0,r.A)(c.G.common.admonition,c.G.common.admonitionType(e),d,n),children:t})}function f({icon:e,title:n}){return(0,o.jsxs)("div",{className:l,children:[(0,o.jsx)("span",{className:h,children:e}),n]})}function p({children:e}){return e?(0,o.jsx)("div",{className:u,children:e}):null}function x(e){const{type:n,icon:t,title:i,children:s,className:r}=e;return(0,o.jsxs)(m,{type:n,className:r,children:[i||t?(0,o.jsx)(f,{title:i,icon:t}):null,(0,o.jsx)(p,{children:s})]})}function g(e){return(0,o.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})})}const j={icon:(0,o.jsx)(g,{}),title:(0,o.jsx)(a.A,{id:"theme.admonition.note",description:"The default label used for the Note admonition (:::note)",children:"note"})};function b(e){return(0,o.jsx)(x,{...j,...e,className:(0,r.A)("alert alert--secondary",e.className),children:e.children})}function v(e){return(0,o.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})})}const w={icon:(0,o.jsx)(v,{}),title:(0,o.jsx)(a.A,{id:"theme.admonition.tip",description:"The default label used for the Tip admonition (:::tip)",children:"tip"})};function y(e){return(0,o.jsx)(x,{...w,...e,className:(0,r.A)("alert alert--success",e.className),children:e.children})}function R(e){return(0,o.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})})}const C={icon:(0,o.jsx)(R,{}),title:(0,o.jsx)(a.A,{id:"theme.admonition.info",description:"The default label used for the Info admonition (:::info)",children:"info"})};function T(e){return(0,o.jsx)(x,{...C,...e,className:(0,r.A)("alert alert--info",e.className),children:e.children})}function N(e){return(0,o.jsx)("svg",{viewBox:"0 0 16 16",...e,children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})})}const A={icon:(0,o.jsx)(N,{}),title:(0,o.jsx)(a.A,{id:"theme.admonition.warning",description:"The default label used for the Warning admonition (:::warning)",children:"warning"})};function D(e){return(0,o.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})})}const M={icon:(0,o.jsx)(D,{}),title:(0,o.jsx)(a.A,{id:"theme.admonition.danger",description:"The default label used for the Danger admonition (:::danger)",children:"danger"})};const I={icon:(0,o.jsx)(N,{}),title:(0,o.jsx)(a.A,{id:"theme.admonition.caution",description:"The default label used for the Caution admonition (:::caution)",children:"caution"})};const S={...{note:b,tip:y,info:T,warning:function(e){return(0,o.jsx)(x,{...A,...e,className:(0,r.A)("alert alert--warning",e.className),children:e.children})},danger:function(e){return(0,o.jsx)(x,{...M,...e,className:(0,r.A)("alert alert--danger",e.className),children:e.children})}},...{secondary:e=>(0,o.jsx)(b,{title:"secondary",...e}),important:e=>(0,o.jsx)(T,{title:"important",...e}),success:e=>(0,o.jsx)(y,{title:"success",...e}),caution:function(e){return(0,o.jsx)(x,{...I,...e,className:(0,r.A)("alert alert--warning",e.className),children:e.children})}}};function V(e){const n=s(e),t=(i=n.type,S[i]||(console.warn(`No admonition component found for admonition type "${i}". Using Info as fallback.`),S.info));var i;return(0,o.jsx)(t,{...n})}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(6540);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},9866:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"topics/desicions/rename-to-vidraResource","title":"Refactoring Manifest Download, Resource Renaming, and Separation of Concerns in VidraResource","description":"Context and Problem Statement","source":"@site/docs/topics/desicions/0018-rename-to-vidraResource.md","sourceDirName":"topics/desicions","slug":"/topics/desicions/rename-to-vidraResource","permalink":"/vidra/topics/desicions/rename-to-vidraResource","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":19,"frontMatter":{"title":"Refactoring Manifest Download, Resource Renaming, and Separation of Concerns in VidraResource","sidebar_position":19},"sidebar":"cliSidebar","previous":{"title":"Event-Driven vs. Owns-Based Reconciliation for Managed Resources","permalink":"/vidra/topics/desicions/eventbased-k8s"},"next":{"title":"CI/CD and Helm Chart Integration for Vidra Operator","permalink":"/vidra/topics/desicions/ci-and-helm"}}');var o=t(4848),s=t(8453),r=t(7293);const a={title:"Refactoring Manifest Download, Resource Renaming, and Separation of Concerns in VidraResource",sidebar_position:19},c="Refactoring Manifest Download, Resource Renaming, and Separation of Concerns in VidraResource",d={},l=[{value:"Context and Problem Statement",id:"context-and-problem-statement",level:2},{value:"Considered Options",id:"considered-options",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"Consequences",id:"consequences",level:3}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"refactoring-manifest-download-resource-renaming-and-separation-of-concerns-in-vidraresource",children:"Refactoring Manifest Download, Resource Renaming, and Separation of Concerns in VidraResource"})}),"\n",(0,o.jsx)(n.h2,{id:"context-and-problem-statement",children:"Context and Problem Statement"}),"\n",(0,o.jsxs)(n.p,{children:["After implementing the fourth GitOps principle, we realized that downloading the manifest could be handled within the ",(0,o.jsx)(n.code,{children:"InfrahubSync"})," controller (formerly it was handled in the second controller called ",(0,o.jsx)(n.code,{children:"InfrahubResource"}),"). By saving the checksum of the artifact in the status section and checking it during each reconciliation, we ensure that the manifest is only downloaded when the checksum changes. (This logic was implemented once the second controller needed to run in a interval to ensure the actual system state matches the desired state in Infrahub.)"]}),"\n",(0,o.jsxs)(n.p,{children:["This change separates the concerns of connecting to Infrahub from managing resources on the Kubernetes cluster based on the manifest. And simplifies the ",(0,o.jsx)(n.code,{children:"VidraResource"})," CRD by removing the manifest field from the status section and eliminating the need for dublicating a separate source section. Instead, the manifest can be stored in the ",(0,o.jsx)(n.code,{children:"spec"})," of the ",(0,o.jsx)(n.code,{children:"VidraResource"}),", aligning more with kubernetes best practices of storing desired state in the ",(0,o.jsx)(n.code,{children:"spec"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Additionally, this refactoring led to renaming the ",(0,o.jsx)(n.code,{children:"InfrahubResource"})," to ",(0,o.jsx)(n.code,{children:"VidraResource"}),", reflecting the broader scope and purpose of the resource and avoiding confution with the ",(0,o.jsx)(n.code,{children:"InfrahubSync"})," CRD. The ",(0,o.jsx)(n.code,{children:"VidraResource"})," now represents any Kubernetes resource that can be managed by Vidra, not just those related to Infrahub."]}),"\n",(0,o.jsx)(n.p,{children:"This refactoring also enables the creation of additional sync controllers for any other external systems in the future, increasing extensibility."}),"\n",(0,o.jsx)(r.A,{type:"note",title:"Note",children:(0,o.jsxs)(n.p,{children:["This was a not considered during planning. We initially implemented the manifest download logic in the ",(0,o.jsx)(n.code,{children:"InfrahubResource"})," controller, but as we progressed, we recognized the need for a cleaner separation of concerns and better alignment with Kubernetes best practices."]})}),"\n",(0,o.jsx)(n.h2,{id:"considered-options",children:"Considered Options"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Keep manifest download in the main controller"}),"\nOne considered option is to keep the manifest download logic within the main controller. This approach would mix concerns by combining Infrahub-specific logic with Kubernetes resource management in the ",(0,o.jsx)(n.code,{children:"Resource"})," controller. The manifest field would remain in the status section, and a separate source section would still be required in the CRD. While this option would not require additional implementation effort\u2014since the current setup is already in place and tested\u2014it would limit future extensibility. The controller would remain tightly coupled to Infrahub, making it harder to adapt for other external systems or expand the operator in the future."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Move manifest download to InfrahubSync"}),"\nThis option involves moving the manifest download logic to the ",(0,o.jsx)(n.code,{children:"InfrahubSync"})," controller. The controller would handle downloading the manifest based on the same logic by storing the checksum in the status section, ensuring that the manifest is only downloaded when necessary. The ",(0,o.jsx)(n.code,{children:"VidraResource"})," CRD would be simplified by removing the manifest field from the status section and eliminating the need for a source section in the ",(0,o.jsx)(n.code,{children:"spec"}),". The ",(0,o.jsx)(n.code,{children:"VidraResource"})," would then represent any Kubernetes resource managed by Vidra, not just those related to Infrahub."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"decision-outcome",children:"Decision Outcome"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Chosen option: Move manifest download to InfrahubSync, refactor CRD, and rename resource"}),", because it provides a cleaner separation of concerns, simplifies the CRD, and aligns with Kubernetes best practices by storing the desired state in the ",(0,o.jsx)(n.code,{children:"spec"}),". This approach also allows for future extensibility by enabling the creation of additional sync controllers for other external systems."]}),"\n",(0,o.jsx)(n.h3,{id:"consequences",children:"Consequences"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Good, because it improves maintainability, clarity, and separation of concerns, and allows for future extensibility."}),"\n",(0,o.jsxs)(n.li,{children:["Good, because it aligns with Kubernetes best practices by storing the desired state in the ",(0,o.jsx)(n.code,{children:"spec"})," and removing unnecessary duplication."]}),"\n",(0,o.jsx)(n.li,{children:"Good, because it enables the creation of additional sync controllers for other external systems in the future, increasing extensibility."}),"\n",(0,o.jsx)(n.li,{children:"Bad, because it requires changes to the CRD, controller logic and tests, includes renaming a CRD in the Operator SDK, which is not intended by the Operator SDK."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);