"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7054],{4023:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"topics/desicions/multi-ownment","title":"Managed Resource Ownership and Cleanup Labels","description":"Context and Problem Statement","source":"@site/docs/topics/desicions/0010-multi-ownment.md","sourceDirName":"topics/desicions","slug":"/topics/desicions/multi-ownment","permalink":"/vidra/topics/desicions/multi-ownment","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"title":"Managed Resource Ownership and Cleanup Labels","sidebar_position":11},"sidebar":"cliSidebar","previous":{"title":"Use of Finalizer for Resource Cleanup","permalink":"/vidra/topics/desicions/finalizer"},"next":{"title":"Multi-Cluster Feature for Vidra Operator","permalink":"/vidra/topics/desicions/multi-cluster-feature"}}');var r=s(4848),o=s(8453);const t={title:"Managed Resource Ownership and Cleanup Labels",sidebar_position:11},a="Managed Resource Ownership and Cleanup Labels",c={},d=[{value:"Context and Problem Statement",id:"context-and-problem-statement",level:2},{value:"Considered Options",id:"considered-options",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2}];function l(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"managed-resource-ownership-and-cleanup-labels",children:"Managed Resource Ownership and Cleanup Labels"})}),"\n",(0,r.jsx)(n.h2,{id:"context-and-problem-statement",children:"Context and Problem Statement"}),"\n",(0,r.jsxs)(n.p,{children:["We encountered a problem where a managed resource could be owned by two different ",(0,r.jsx)(n.code,{children:"InfrahubSync"})," resources. This created ambiguity in resource ownership and cleanup responsibilities."]}),"\n",(0,r.jsx)(n.p,{children:"To address this, we needed a way to track both general management by Vidra and specific ownership by one or more Infrahub resources. Additionally, we wanted to avoid overwriting existing resources in the cluster unless they are explicitly managed by Vidra."}),"\n",(0,r.jsx)(n.h2,{id:"considered-options",children:"Considered Options"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"No explicit ownership tracking"}),(0,r.jsx)(n.br,{}),"\n","Relies on Kubernetes owner references or manual tracking, which can lead to conflicts and unclear cleanup responsibilities."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Implement labels for management and ownership"}),(0,r.jsx)(n.br,{}),"\n","Use a ",(0,r.jsx)(n.code,{children:"managed-by"})," label to indicate Vidra management, and an ",(0,r.jsx)(n.code,{children:"owned-by"})," label containing a list of ",(0,r.jsx)(n.code,{children:"VidraResources"})," responsible for the managed resource."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"decision-outcome",children:"Decision Outcome"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:'Chosen option: "Implement managed-by and owned-by labels"'}),(0,r.jsx)(n.br,{}),"\n","We decided to add two labels to all managed resources:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"managed-by"}),": Indicates the resource is managed by Vidra."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"owned-by"}),": Contains a list of ",(0,r.jsx)(n.code,{children:"VidraResources"})," that currently own the resource."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This approach enables:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Accurate tracking of which ",(0,r.jsx)(n.code,{children:"VidraResources"})," are responsible for cleanup."]}),"\n",(0,r.jsxs)(n.li,{children:["Additional benefit: Prevents overwriting resources not managed by Vidra by checking the ",(0,r.jsx)(n.code,{children:"managed-by"})," label before creating or updating resources."]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Good, because it enables correct cleanup, prevents accidental overwrites, and clarifies resource ownership."}),"\n",(0,r.jsx)(n.li,{children:"Bad, because it introduces additional label management logic and requires consistent label updates as ownership changes."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var i=s(6540);const r={},o=i.createContext(r);function t(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);