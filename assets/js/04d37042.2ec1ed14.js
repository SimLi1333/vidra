"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9639],{5596:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"topics/architecture","title":"Vidra CLI Architecture","description":"The Vidra CLI is structured following clean architecture principles, using Go Cobra for command-line parsing and execution.","source":"@site/docs-cli/topics/architecture.md","sourceDirName":"topics","slug":"/topics/architecture","permalink":"/vidra/cli/topics/architecture","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"cliSidebar","previous":{"title":"Usage","permalink":"/vidra/cli/guides/usage"}}');var t=i(4848),s=i(8453),a=i(7293);const c={},o="Vidra CLI Architecture",l={},d=[{value:"Folder Structure",id:"folder-structure",level:2},{value:"Architectural Overview",id:"architectural-overview",level:2},{value:"kubecli Adapter",id:"kubecli-adapter",level:2},{value:"Resource Naming Strategy",id:"resource-naming-strategy",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Function reuse",id:"function-reuse",level:2}];function h(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"vidra-cli-architecture",children:"Vidra CLI Architecture"})}),"\n",(0,t.jsxs)(n.p,{children:["The Vidra CLI is structured following clean architecture principles, using ",(0,t.jsx)(n.a,{href:"https://github.com/spf13/cobra",children:"Go Cobra"})," for command-line parsing and execution."]}),"\n",(0,t.jsx)(n.h2,{id:"folder-structure",children:"Folder Structure"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/infrahub-operator/vidra/tree/main/vidra-cli/cmd",children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"cmd/"})})}),"\nContains all CLI commands and operations. Each command is defined as a separate file or package, leveraging Cobra for argument parsing and command handling."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/infrahub-operator/vidra/tree/main/vidra-cli/internal/service",children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"internal/service/"})})}),(0,t.jsx)(n.br,{}),"\n","Implements the core logic for each command. This layer contains business logic and some tests, ensuring that command implementations remain decoupled from infrastructure concerns."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/infrahub-operator/vidra/tree/main/vidra-cli/internal/adapter",children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"internal/adapter/"})})}),"\nProvides reusable Kubernetes client (",(0,t.jsx)(n.code,{children:"kubecli"}),") functions. This adapter abstract infrastructure details and are accessed via interfaces, enabling easy mocking and testing."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"architectural-overview",children:"Architectural Overview"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Commands"})," in ",(0,t.jsx)(n.code,{children:"cmd/"})," delegate to ",(0,t.jsx)(n.strong,{children:"services"})," in ",(0,t.jsx)(n.code,{children:"internal/service/"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Services"})," interact with ",(0,t.jsx)(n.strong,{children:"adapters"})," in ",(0,t.jsx)(n.code,{children:"internal/adapter/"})," for Kubernetes operations."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Adapters"})," encapsulate external dependencies, promoting testability and maintainability and enable reuse of the same fuction for all commands / services."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This separation ensures a modular, testable, and maintainable CLI codebase."}),"\n",(0,t.jsx)(a.A,{type:"note",title:"Note",children:(0,t.jsxs)(n.p,{children:["You can explore the implementation of these layers in the ",(0,t.jsx)(n.a,{href:"https://github.com/infrahub-operator/vidra/tree/main/vidra-cli",children:"vidra-cli directory"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"kubecli-adapter",children:"kubecli Adapter"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"kubecli"})," adapter provides a set of reusable functions for interacting with Kubernetes clusters. It abstracts the complexity of Kubernetes API calls, allowing reusable operations across all different commands. This adapter is designed to be used by the service layer, providing a consistent interface for Kubernetes operations."]}),"\n",(0,t.jsx)(n.h2,{id:"resource-naming-strategy",children:"Resource Naming Strategy"}),"\n",(0,t.jsx)(n.p,{children:"To generate meaningful yet unique resource names, the CLI uses hashing of unique input values. For example, when creating a kubeconfig for a cluster, the resource name is derived as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cluster-kubeconfig-{hash of cluster name}\n"})}),"\n",(0,t.jsx)(n.p,{children:"This approach ensures that resource names are both descriptive and collision-resistant, while avoiding exposure of sensitive or overly long identifiers."}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.p,{children:"Each cli command has its own error handler that is responsible for formatting and returning errors in a consistent manner. This allows for better user experience and easier debugging."}),"\n",(0,t.jsx)(n.p,{children:"Like if a cluster secet apply fails because the command is incomplete, the error handler will also prompt the user with the available cluster contexts in their kubeconfig file, allowing them to select one of them to create a kubeconfig secret for that cluster."}),"\n",(0,t.jsx)(n.p,{children:"Default timeouts for all commands are set to 1 minute using a context Deadline. This ensures that commands do not hang indefinitely and provides a consistent timeout behavior across the CLI."}),"\n",(0,t.jsx)(n.h2,{id:"function-reuse",children:"Function reuse"}),"\n",(0,t.jsxs)(n.p,{children:["The CLI is designed to maximize function reuse across different commands. For example, the ",(0,t.jsx)(n.code,{children:"kubecli"})," adapter provides functions for applying, deleting, and retrieving Kubernetes secrets, which are used by multiple commands. This reduces code duplication and ensures consistency in how Kubernetes operations are performed."]}),"\n",(0,t.jsx)(n.p,{children:"Additionally it ads maintainability and testability, as changes to the underlying logic only need to be made in one place."})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},7293:(e,n,i)=>{i.d(n,{A:()=>R});var r=i(6540),t=i(4848);function s(e){const{mdxAdmonitionTitle:n,rest:i}=function(e){const n=r.Children.toArray(e),i=n.find((e=>r.isValidElement(e)&&"mdxAdmonitionTitle"===e.type)),s=n.filter((e=>e!==i)),a=i?.props.children;return{mdxAdmonitionTitle:a,rest:s.length>0?(0,t.jsx)(t.Fragment,{children:s}):null}}(e.children),s=e.title??n;return{...e,...s&&{title:s},children:i}}var a=i(4164),c=i(1312),o=i(7559);const l="admonition_xJq3",d="admonitionHeading_Gvgb",h="admonitionIcon_Rf37",u="admonitionContent_BuS1";function m({type:e,className:n,children:i}){return(0,t.jsx)("div",{className:(0,a.A)(o.G.common.admonition,o.G.common.admonitionType(e),l,n),children:i})}function p({icon:e,title:n}){return(0,t.jsxs)("div",{className:d,children:[(0,t.jsx)("span",{className:h,children:e}),n]})}function f({children:e}){return e?(0,t.jsx)("div",{className:u,children:e}):null}function x(e){const{type:n,icon:i,title:r,children:s,className:a}=e;return(0,t.jsxs)(m,{type:n,className:a,children:[r||i?(0,t.jsx)(p,{title:r,icon:i}):null,(0,t.jsx)(f,{children:s})]})}function g(e){return(0,t.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})})}const j={icon:(0,t.jsx)(g,{}),title:(0,t.jsx)(c.A,{id:"theme.admonition.note",description:"The default label used for the Note admonition (:::note)",children:"note"})};function v(e){return(0,t.jsx)(x,{...j,...e,className:(0,a.A)("alert alert--secondary",e.className),children:e.children})}function b(e){return(0,t.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})})}const y={icon:(0,t.jsx)(b,{}),title:(0,t.jsx)(c.A,{id:"theme.admonition.tip",description:"The default label used for the Tip admonition (:::tip)",children:"tip"})};function w(e){return(0,t.jsx)(x,{...y,...e,className:(0,a.A)("alert alert--success",e.className),children:e.children})}function A(e){return(0,t.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})})}const C={icon:(0,t.jsx)(A,{}),title:(0,t.jsx)(c.A,{id:"theme.admonition.info",description:"The default label used for the Info admonition (:::info)",children:"info"})};function N(e){return(0,t.jsx)(x,{...C,...e,className:(0,a.A)("alert alert--info",e.className),children:e.children})}function T(e){return(0,t.jsx)("svg",{viewBox:"0 0 16 16",...e,children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})})}const k={icon:(0,t.jsx)(T,{}),title:(0,t.jsx)(c.A,{id:"theme.admonition.warning",description:"The default label used for the Warning admonition (:::warning)",children:"warning"})};function z(e){return(0,t.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})})}const I={icon:(0,t.jsx)(z,{}),title:(0,t.jsx)(c.A,{id:"theme.admonition.danger",description:"The default label used for the Danger admonition (:::danger)",children:"danger"})};const L={icon:(0,t.jsx)(T,{}),title:(0,t.jsx)(c.A,{id:"theme.admonition.caution",description:"The default label used for the Caution admonition (:::caution)",children:"caution"})};const M={...{note:v,tip:w,info:N,warning:function(e){return(0,t.jsx)(x,{...k,...e,className:(0,a.A)("alert alert--warning",e.className),children:e.children})},danger:function(e){return(0,t.jsx)(x,{...I,...e,className:(0,a.A)("alert alert--danger",e.className),children:e.children})}},...{secondary:e=>(0,t.jsx)(v,{title:"secondary",...e}),important:e=>(0,t.jsx)(N,{title:"important",...e}),success:e=>(0,t.jsx)(w,{title:"success",...e}),caution:function(e){return(0,t.jsx)(x,{...L,...e,className:(0,a.A)("alert alert--warning",e.className),children:e.children})}}};function R(e){const n=s(e),i=(r=n.type,M[r]||(console.warn(`No admonition component found for admonition type "${r}". Using Info as fallback.`),M.info));var r;return(0,t.jsx)(i,{...n})}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>c});var r=i(6540);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);